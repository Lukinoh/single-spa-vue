{"version":3,"file":"parcel.js","sources":["../../src/parcel.js"],"sourcesContent":["import * as Vue from \"vue\";\n\nconst lessThanVue3 = !Vue.version || /^[012]\\..+/.test(Vue.version);\n\nexport default {\n  props: {\n    config: [Object, Promise],\n    wrapWith: String,\n    wrapClass: String,\n    wrapStyle: Object,\n    mountParcel: Function,\n    parcelProps: Object,\n  },\n  render(h) {\n    // Vue 2 works differently than Vue 3\n    h = typeof h === \"function\" ? h : Vue.h || (Vue.default && Vue.default.h);\n\n    const containerTagName = this.wrapWith || \"div\";\n    const props = { ref: \"container\" };\n    if (this.wrapClass) {\n      props.class = this.wrapClass;\n    }\n    if (this.wrapStyle) {\n      props.style = this.wrapStyle;\n    }\n    return h(containerTagName, props);\n  },\n  data() {\n    return {\n      hasError: false,\n    };\n  },\n  methods: {\n    addThingToDo(action, thing) {\n      if (this.hasError && action !== \"unmount\") {\n        return;\n      }\n\n      this.nextThingToDo = (this.nextThingToDo || Promise.resolve())\n        .then((...args) => {\n          if (this.unmounted && action !== \"unmount\") {\n            return;\n          }\n\n          return thing.apply(this, args);\n        })\n        .catch((err) => {\n          this.nextThingToDo = Promise.resolve();\n          this.hasError = true;\n\n          if (err && err.message) {\n            err.message = `During '${action}', parcel threw an error: ${err.message}`;\n          }\n\n          this.$emit(\"parcelError\", err);\n\n          throw err;\n        });\n    },\n    singleSpaMount() {\n      this.parcel = this.mountParcel(this.config, this.getParcelProps());\n\n      return this.parcel.mountPromise.then(() => {\n        this.$emit(\"parcelMounted\");\n      });\n    },\n    singleSpaUnmount() {\n      if (this.parcel && this.parcel.getStatus() === \"MOUNTED\") {\n        return this.parcel.unmount();\n      }\n    },\n    singleSpaUpdate() {\n      if (this.parcel && this.parcel.update) {\n        return this.parcel.update(this.getParcelProps()).then(() => {\n          this.$emit(\"parcelUpdated\");\n        });\n      }\n    },\n    getParcelProps() {\n      return {\n        domElement: this.$refs.container,\n        ...(this.parcelProps || {}),\n      };\n    },\n  },\n  mounted() {\n    if (!this.config) {\n      throw Error(`single-spa-vue: <parcel> component requires a config prop.`);\n    }\n\n    if (!this.mountParcel) {\n      throw Error(\n        `single-spa-vue: <parcel> component requires a mountParcel prop`\n      );\n    }\n\n    if (this.config) {\n      this.addThingToDo(\"mount\", this.singleSpaMount);\n    }\n  },\n  [lessThanVue3 ? \"destroyed\" : \"unmounted\"]() {\n    this.addThingToDo(\"unmount\", this.singleSpaUnmount);\n  },\n  watch: {\n    parcelProps: {\n      handler(parcelProps) {\n        this.addThingToDo(\"update\", this.singleSpaUpdate);\n      },\n    },\n  },\n};\n"],"names":["lessThanVue3","Vue","version","test","parcel","_props$render$data$me","props","config","Object","Promise","wrapWith","String","wrapClass","wrapStyle","mountParcel","Function","parcelProps","render","h","containerTagName","this","ref","style","data","hasError","methods","addThingToDo","action","thing","_this","nextThingToDo","resolve","then","unmounted","_len","arguments","length","args","Array","_key","apply","err","message","concat","$emit","singleSpaMount","_this2","getParcelProps","mountPromise","singleSpaUnmount","getStatus","unmount","singleSpaUpdate","_this3","update","_objectSpread","domElement","$refs","container","mounted","Error","_defineProperty","handler"],"mappings":"k6CAEA,IAAMA,GAAgBC,EAAIC,SAAW,aAAaC,KAAKF,EAAIC,SAE3DE,GAAAC,EAAA,CACEC,MAAO,CACLC,OAAQ,CAACC,OAAQC,SACjBC,SAAUC,OACVC,UAAWD,OACXE,UAAWL,OACXM,YAAaC,SACbC,YAAaR,QAEfS,OAAM,SAACC,GAELA,EAAiB,mBAANA,EAAmBA,EAAIjB,EAAIiB,GAAMjB,EAAG,SAAYA,EAAG,QAASiB,EAEvE,IAAMC,EAAmBC,KAAKV,UAAY,MACpCJ,EAAQ,CAAEe,IAAK,aAOrB,OANID,KAAKR,YACPN,EAAW,MAAGc,KAAKR,WAEjBQ,KAAKP,YACPP,EAAMgB,MAAQF,KAAKP,WAEdK,EAAEC,EAAkBb,EAC5B,EACDiB,KAAI,WACF,MAAO,CACLC,UAAU,EAEb,EACDC,QAAS,CACPC,aAAYA,SAACC,EAAQC,GAAO,IAAAC,EAAAT,KACtBA,KAAKI,UAAuB,YAAXG,IAIrBP,KAAKU,eAAiBV,KAAKU,eAAiBrB,QAAQsB,WACjDC,MAAK,WACJ,IAAIH,EAAKI,WAAwB,YAAXN,EAAtB,CAEC,IAAA,IAAAO,EAAAC,UAAAC,OAHOC,EAAIC,IAAAA,MAAAJ,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAJF,EAAIE,GAAAJ,UAAAI,GAKZ,OAAOX,EAAMY,MAAMX,EAAMQ,EAFzB,CAGF,IAAE,OACK,SAACI,GAUN,MATAZ,EAAKC,cAAgBrB,QAAQsB,UAC7BF,EAAKL,UAAW,EAEZiB,GAAOA,EAAIC,UACbD,EAAIC,QAAOC,WAAAA,OAAchB,EAAMgB,8BAAAA,OAA6BF,EAAIC,UAGlEb,EAAKe,MAAM,cAAeH,GAEpBA,CACR,IACH,EACDI,eAAc,WAAG,IAAAC,EAAA1B,KAGf,OAFAA,KAAKhB,OAASgB,KAAKN,YAAYM,KAAKb,OAAQa,KAAK2B,kBAE1C3B,KAAKhB,OAAO4C,aAAahB,MAAK,WACnCc,EAAKF,MAAM,gBACb,GACD,EACDK,iBAAgB,WACd,GAAI7B,KAAKhB,QAAsC,YAA5BgB,KAAKhB,OAAO8C,YAC7B,OAAO9B,KAAKhB,OAAO+C,SAEtB,EACDC,gBAAe,WAAG,IAAAC,EAAAjC,KAChB,GAAIA,KAAKhB,QAAUgB,KAAKhB,OAAOkD,OAC7B,OAAOlC,KAAKhB,OAAOkD,OAAOlC,KAAK2B,kBAAkBf,MAAK,WACpDqB,EAAKT,MAAM,gBACb,GAEH,EACDG,eAAc,WACZ,sWAAAQ,CAAA,CACEC,WAAYpC,KAAKqC,MAAMC,WACnBtC,KAAKJ,aAAe,CAAA,EAE5B,GAEF2C,QAAO,WACL,IAAKvC,KAAKb,OACR,MAAMqD,oEAGR,IAAKxC,KAAKN,YACR,MAAM8C,wEAKJxC,KAAKb,QACPa,KAAKM,aAAa,QAASN,KAAKyB,eAEpC,GAACgB,EAAAxD,EACAL,EAAe,YAAc,aAAe,WAC3CoB,KAAKM,aAAa,UAAWN,KAAK6B,iBACpC,IAACY,EAAAxD,EACM,QAAA,CACLW,YAAa,CACX8C,QAAO,SAAC9C,GACNI,KAAKM,aAAa,SAAUN,KAAKgC,gBACnC,KAEH/C"}